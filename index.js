function e(e,t){if(t==null||t>e.length)t=e.length;for(var n=0,o=new Array(t);n<t;n++)o[n]=e[n];return o}function t(e){if(Array.isArray(e))return e}function n(t){if(Array.isArray(t))return e(t)}function o(e,t,n,o,a,r,i){try{var l=e[r](i);var u=l.value}catch(e){n(e);return}if(l.done){t(u)}else{Promise.resolve(u).then(o,a)}}function a(e){return function(){var t=this,n=arguments;return new Promise(function(a,r){var i=e.apply(t,n);function l(e){o(i,a,r,l,u,"next",e)}function u(e){o(i,a,r,l,u,"throw",e)}l(undefined)})}}function r(e,t,n){if(m()){r=Reflect.construct}else{r=function e(e,t,n){var o=[null];o.push.apply(o,t);var a=Function.bind.apply(e,o);var r=new a;if(n)d(r,n.prototype);return r}}return r.apply(null,arguments)}function i(e,t){if(t!=null&&typeof Symbol!=="undefined"&&t[Symbol.hasInstance]){return!!t[Symbol.hasInstance](e)}else{return e instanceof t}}function l(e){if(typeof Symbol!=="undefined"&&e[Symbol.iterator]!=null||e["@@iterator"]!=null)return Array.from(e)}function u(e,t){var n=e==null?null:typeof Symbol!=="undefined"&&e[Symbol.iterator]||e["@@iterator"];if(n==null)return;var o=[];var a=true;var r=false;var i,l;try{for(n=n.call(e);!(a=(i=n.next()).done);a=true){o.push(i.value);if(t&&o.length===t)break}}catch(e){r=true;l=e}finally{try{if(!a&&n["return"]!=null)n["return"]()}finally{if(r)throw l}}return o}function s(){throw new TypeError("Invalid attempt to destructure non-iterable instance.\\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}function c(){throw new TypeError("Invalid attempt to spread non-iterable instance.\\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}function d(e,t){d=Object.setPrototypeOf||function e(e,t){e.__proto__=t;return e};return d(e,t)}function f(e,n){return t(e)||u(e,n)||b(e,n)||s()}function p(e){return n(e)||l(e)||b(e)||c()}function b(t,n){if(!t)return;if(typeof t==="string")return e(t,n);var o=Object.prototype.toString.call(t).slice(8,-1);if(o==="Object"&&t.constructor)o=t.constructor.name;if(o==="Map"||o==="Set")return Array.from(o);if(o==="Arguments"||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(o))return e(t,n)}function m(){if(typeof Reflect==="undefined"||!Reflect.construct)return false;if(Reflect.construct.sham)return false;if(typeof Proxy==="function")return true;try{Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){}));return true}catch(e){return false}}function h(e,t){var n,o,a,r,i={label:0,sent:function(){if(a[0]&1)throw a[1];return a[1]},trys:[],ops:[]};return r={next:l(0),"throw":l(1),"return":l(2)},typeof Symbol==="function"&&(r[Symbol.iterator]=function(){return this}),r;function l(e){return function(t){return u([e,t])}}function u(r){if(n)throw new TypeError("Generator is already executing.");while(i)try{if(n=1,o&&(a=r[0]&2?o["return"]:r[0]?o["throw"]||((a=o["return"])&&a.call(o),0):o.next)&&!(a=a.call(o,r[1])).done)return a;if(o=0,a)r=[r[0]&2,a.value];switch(r[0]){case 0:case 1:a=r;break;case 4:i.label++;return{value:r[1],done:false};case 5:i.label++;o=r[1];r=[0];continue;case 7:r=i.ops.pop();i.trys.pop();continue;default:if(!(a=i.trys,a=a.length>0&&a[a.length-1])&&(r[0]===6||r[0]===2)){i=0;continue}if(r[0]===3&&(!a||r[1]>a[0]&&r[1]<a[3])){i.label=r[1];break}if(r[0]===6&&i.label<a[1]){i.label=a[1];a=r;break}if(a&&i.label<a[2]){i.label=a[2];i.ops.push(r);break}if(a[2])i.ops.pop();i.trys.pop();continue}r=t.call(e,i)}catch(e){r=[6,e];o=0}finally{n=a=0}if(r[0]&5)throw r[1];return{value:r[0]?r[1]:void 0,done:true}}}import{Lucid as y,Blockfrost as w,Kupmios as g,getAddressDetails as v}from"./lucid-cardano/mod.js";import{ContractBond as x,toAddress as D}from"./mod.js";import{networks as _,wallets as O,explorers as k,providers as B,optimFinance as I}from"./common.js?t=2";(function(e){var t=e("button.act-optim"),n=e(".act-market"),o=e("button.act-market-wallet"),l=function e(){var e=arguments.length>0&&arguments[0]!==void 0?arguments[0]:new Map;return Array.from(e.entries(),function(e){var t=f(e,2),n=t[0],o=t[1];return i(o,Map)?{key:n,value:l(o)}:{key:n,value:o}})},u=function e(){var e=new Date().getTime();var t=typeof performance!=="undefined"&&performance.now&&performance.now()*1e3||0;return"xxxxxxxx-xxxx-4xxx-yxxx-xxxxxxxxxxxx".replace(/[xy]/g,function(n){var o=Math.random()*16;if(e>0){o=(e+o)%16|0;e=Math.floor(e/16)}else{o=(t+o)%16|0;t=Math.floor(t/16)}return(n==="x"?o:o&3|8).toString(16)})},s=document.getElementById("zone-alert"),c=e("#wallet-info"),d=e("#zone-connect"),b=function t(){e.confirm({title:"Warning!",content:["Install & active one of wallet below:</br>"].concat(S.map(function(e,t){return"".concat(t+1,". ").concat(Z(e))})).join(""),buttons:{ok:{btnClass:"btn-blue",action:function e(){location.reload()}}}})},m="SEL_WALLET",P=e("select#sel-wallet"),S=Object.keys(O),E=function e(){return P.find("option")},C=function t(){if(E().length<=0){P.html("");if(typeof window.cardano!="undefined"){S.forEach(function(t){if(typeof window.cardano[t]!="undefined"){P.append(e('<option value="'.concat(t,'">').concat(O[t].name,"</option>")))}})}}P.prop("disabled",E().length<=0);P.off("change");if(E().length>0){var t=localStorage.getItem(m);if(typeof t!="undefined"&&t!=""&&t!="null"){P.val(t)}}},W=function(){var i=a(function(){var a,i,l,u,s,c,d,b,m,w,g,v,D,_;return h(this,function(h){switch(h.label){case 0:e("#asset-name").off("keypress");t.prop("disabled",true);n.prop("disabled",true);er(false);h.label=1;case 1:h.trys.push([1,4,,5]);a=j();if(!(a in N)){z("Error: ".concat(a," provider not supported!"),"danger");return[2]}if(!(a in B)){z("Error: ".concat(a," provider not found config!"),"danger");return[2]}i=T();if(!(i in B[a])){z("Error: ".concat(i," network not supported for provider ").concat(a,"!"),"danger");return[2]}l=[];eW=i in I;eA=eW?I[i]:undefined;t.off("click");if(!eW){l.push("- Not support action get escrow of bond!")}else{e("#act-get-token").on("click",eD);e("#asset-name").keypress(function(t){var n=t.keyCode?t.keyCode:t.which;if(n=="13"&&!e("#act-get-token").is(":disabled")){e("#act-get-token").trigger("click")}})}eN=eA!=undefined&&"danogoConfig"in eA&&eA["danogoConfig"]["deployHash"]!="";n.off("click");o.off("click");U.html("");if(!eN){l.push("- Not support action market bond!")}else{if(eA!=undefined&&"smart_contract"in eA){u=true,s=false,c=undefined;try{for(d=Object.entries(eA.smart_contract)[Symbol.iterator]();!(u=(b=d.next()).done);u=true){m=f(b.value,2),w=m[0],g=m[1];U.append(e('<option value="'+w+'">'+g+"</option>"))}}catch(e){s=true;c=e}finally{try{if(!u&&d.return!=null){d.return()}}finally{if(s){throw c}}}}else{U.append(e('<option value="latest">Latest</option>'))}e("#act-get-token-listing").off("click");e("#act-get-token-listing").on("click",ek)}if(l.length>0){z("".concat(i," network warning: </br>").concat(l.join("</br>")),"warning")}if(typeof window.apps=="undefined"){window.apps={wallets:{}}}if(!window.apps.hasOwnProperty(i)){window.apps[i]={}}if(!!window.apps[i].hasOwnProperty(a))return[3,3];v=Object.keys(B[a][i]).map(function(e){return B[a][i][e]});if(v.length<2){throw new Error("Provider config invalid!")}return[4,y.new(r(N[a],p(v)),i)];case 2:D=h.sent();window.apps[i][a]={lucid:D,contract_bond:eA!=undefined&&"danogoConfig"in eA?new x(D,eA.danogoConfig):null};h.label=3;case 3:t.prop("disabled",!eW);n.prop("disabled",!eN);return[3,5];case 4:_=h.sent();z("Error: ".concat(_.message),"danger");return[3,5];case 5:er(true);if(e(ee).is(":hidden")){e("#asset-name").focus()}return[2]}})});return function e(){return i.apply(this,arguments)}}(),N={Blockfrost:w,Kupmios:g},A=e("select#sel-provider"),L=function e(){return A.find("option")},q=function t(){if(L().length<=0){A.html("");Object.keys(N).forEach(function(t){A.append(e('<option value="'+t+'">'+t+"</option>"))})}A.prop("disabled",L().length<=1);A.off("change");if(L().length>0){A.on("change",W)}},j=function e(){return A.val()},R="SEL_NETWORK",H=e("select#sel-network"),M=function e(){return H.find("option")},K=function t(){if(M().length<=0){H.html("");_.forEach(function(t){H.append(e('<option value="'+t+'">'+t+"</option>"))})}H.prop("disabled",M().length<=1);H.off("change");if(M().length>0){var t=localStorage.getItem(R);if(typeof t!="undefined"&&t!=""&&t!="null"){H.val(t)}H.on("change",W)}},T=function e(){var e=H.val();localStorage.setItem(R,e);return e},U=e("select#sel-trade-address"),F=function e(){return U.find("option")},V=function e(){return U.val()},z=function(t,n,o,a,r){var i=e(['<div class="alert alert-'.concat(n).concat(typeof a=="undefined"||a?" alert-dismissible":"").concat(typeof o!="undefined"?" "+o:"",'" role="alert">'),"  <div>".concat(t,"</div>"),typeof a=="undefined"||a?'  <button type="button" class="btn-close" data-bs-dismiss="alert" aria-label="Close"></button>':"","</div>"].join(""));if(typeof r=="undefined"){e(s).append(i)}else{e(r).append(i)}},G=function(t,n){var o=u();var a=e('<pre id="json-renderer-'+o+'"></pre>');if(typeof n=="undefined"){e(s).append(a)}else{e(n).append(a)}e("#json-renderer-"+o).jsonViewer(t,{bigNumbers:true})},Y=function e(e,t){return"".concat(k[H.val()][t]).concat(k["path"][t]["asset"]).concat(e)},Q=function e(e,t){return"".concat(k[H.val()][t]).concat(k["path"][t]["txn"]).concat(e)},$=function e(e){z("txHash: ".concat(e,' (<a class="alert-link" target="_blank" href="').concat((Q(e),eC),'">cardanoscan</a> or <a class="alert-link" target="_blank" href="').concat((Q(e),"cexplorer"),'">cexplorer</a>)'),"success")},J=function e(e){G(e.message==undefined||e.message==""?{error_obj:e}:{error:e.message})},X=function e(e){return'<img height="20" src="'.concat(O[e].ico,'" alt="').concat(O[e].alt,'" style="margin-right:5px;margin-top:-5px;max-height:20px">')},Z=function e(e){return'<a target="_blank" alt="'+O[e].alt+'" href="https://chrome.google.com/webstore/detail/'+O[e].chrome+'">'+X(e)+""+O[e].name+"</a></br>"},ee=e("button#btn-disconnect"),et=function t(){var t=e(this);t.prop("disabled",true);t.hide();c.html("");var n=localStorage.getItem(m);if(typeof n!="undefined"&&n!=""&&n!="null"){localStorage.removeItem(m)}ei(t,false)},en=e("button#btn-connect"),eo=function(){var e=a(function(e){var t,n,o,r,i,l,u,s,d,f,p,y,w,g,x;return h(this,function(D){switch(D.label){case 0:t=P.val();localStorage.setItem(m,t);window.apps.wallet_selected=t;D.label=1;case 1:D.trys.push([1,10,,11]);if(typeof window.cardano=="undefined"){b();return[2,undefined]}n=window.cardano[window.apps.wallet_selected];o=true;return[4,n.isEnabled()];case 2:r=D.sent();if(!(!window.apps.wallets.hasOwnProperty(window.apps.wallet_selected)||!(typeof r=="boolean"?r:r.data)))return[3,4];i=window.apps.wallets;l=window.apps.wallet_selected;return[4,n.enable()];case 3:i[l]=D.sent();if(window.apps.wallets[window.apps.wallet_selected].hasOwnProperty("error"))throw Error(window.apps.wallets[window.apps.wallet_selected].error);else if(!window.apps.wallets[window.apps.wallet_selected].hasOwnProperty("getBalance")&&!window.apps.wallets[window.apps.wallet_selected].hasOwnProperty("experimental")){window.apps.wallets[window.apps.wallet_selected]=n;o=false}D.label=4;case 4:u=window.apps.wallets[window.apps.wallet_selected];return[4,u.getBalance()];case 5:s=D.sent();d=typeof s=="string"?e.balanceOf(s):{"lovelace":BigInt(s.data.ada)};if(o){e.lucid.selectWallet(u)}f="";if(u.hasOwnProperty("experimental")&&u["experimental"].hasOwnProperty("appVersion")){p=u.experimental.appVersion;f="appVersion: ".concat(p.major,".").concat(p.minor,".").concat(p.patch)}else if(u.hasOwnProperty("version"))f="appVersion: ".concat(u.version);y="";if(n.hasOwnProperty("apiVersion")){y="apiVersion: ".concat(n.apiVersion)}if(!o)return[3,7];return[4,e.lucid.wallet.address()];case 6:g=D.sent();return[3,9];case 7:return[4,a(function(){return h(this,function(e){switch(e.label){case 0:return[4,u.getAddress()];case 1:return[2,e.sent().data]}})})()];case 8:g=D.sent();D.label=9;case 9:w=v.apply(void 0,[g]);c.html("");z([X(window.apps.wallet_selected),"<span>".concat(O[window.apps.wallet_selected].name," (").concat(f).concat(f&&y?", ":"").concat(y,")</br>")," - Address: ".concat(w.address.bech32,"</br>")," - PaymentKey: ".concat(w.paymentCredential.hash,"</br>")," - StakeKey: ".concat(w.stakeCredential.hash,"</br>")," - Balance: ".concat(BigNumber(BigNumber(d.lovelace)/1e6).toFormat(6)," ADA"),"</br>".concat(o?"":" - Not support because is not CIP30 wallet"),"</span>"].join(""),o?"success":"warning","mb-0 py-2 mt-3",false,c);return[2,o?u:undefined];case 10:x=D.sent();z("".concat(O[window.apps.wallet_selected].name,' wallet return error "').concat(x.message,'"'),"danger");return[2,undefined];case 11:return[2]}})});return function t(t){return e.apply(this,arguments)}}(),ea=function(){var t=a(function(){var t,n,o,a,r,i,l,u;return h(this,function(s){switch(s.label){case 0:t=e(this);s.label=1;case 1:s.trys.push([1,3,,4]);d.find("select").prop("disabled",true);t.prop("disabled",true);t.html('<span class="spinner-border spinner-border-sm" role="status" aria-hidden="true"></span> Connecting...');o=j(),a=T();r=window.apps[a][o].lucid,i=undefined,l=window.apps[a][o].contract_bond;return[4,eo(l)];case 2:n=s.sent();if(typeof n!="undefined"){r.selectWallet(n);eS(i,l)}return[3,4];case 3:u=s.sent();z("Error: ".concat(u.message),"danger");return[3,4];case 4:ei(t,typeof n!="undefined");return[2]}})});return function e(){return t.apply(this,arguments)}}(),er=function e(e){if(typeof e=="undefined")e=false;ee.prop("disabled",!e);en.prop("disabled",!e)},ei=function e(e,t){if(typeof t=="undefined")t=false;if(t){en.hide();ee.show()}else{o.off("click");en.show();ee.hide()}o.prop("disabled",!(t&&eN));d.find("select").prop("disabled",t);en.html("Connect");e.prop("disabled",false)},el=function e(e,t,n){t?ev():ex();e.prop("disabled",t);e.html(t?'<span class="spinner-border spinner-border-sm" role="status" aria-hidden="true"></span> '+n+"...":n)},eu=function e(e){var t={assets:{}};e.forEach(function(e,n){if(n===""&&i(e,Map)&&e.has("")){t["lovelace"]=e.get("")}else{e.forEach(function(e,o){t["assets"][n+o]=e})}});return t},es=function e(e){if(typeof e=="object"){if(e.hasOwnProperty("minEpoRewards")&&i(e.minEpoRewards,Map)){e.minEpoRewards=eu(e.minEpoRewards)}if(e.hasOwnProperty("epoRewards")&&i(e.epoRewards,Map)){e.epoRewards=eu(e.epoRewards)}}return e},ec=function e(e,t){J(e)},ed=function e(){return 432e6},ef=function e(){return 1647899091e3},ep=function e(){return 328n},eb=function e(e){return BigNumber(e)*ed()},em=function e(e){return eb(e)+ef()},eh=function(){var e=a(function(e,t){var n,o;return h(this,function(a){switch(a.label){case 0:if(!(typeof t.bondWriterData!="undefined"&&typeof t.bondWriterData.utxo!="undefined"&&(typeof t.bondWriterData.utxo.datum!="undefined"||typeof t.bondWriterData.utxo.datumHash!="undefined")))return[3,2];return[4,e.optimBondWriterDatumOf(t.bondWriterData.utxo)];case 1:n=es.apply(void 0,[a.sent()]);t["bondWriterDatum"]=n;a.label=2;case 2:if(!(typeof t.poolOpenData!="undefined"&&typeof t.poolOpenData.utxo!="undefined"&&(typeof t.poolOpenData.utxo.datum!="undefined"||typeof t.poolOpenData.utxo.datumHash!="undefined")&&(t.poolOpenData.utxo.datum||t.poolOpenData.utxo.datumHash)))return[3,4];return[4,e.optimOpenPoolDatumOf(t.poolOpenData.utxo)];case 3:o=es.apply(void 0,[a.sent()]);t["openPoolDatum"]=o;a.label=4;case 4:return[2,t]}})});return function t(t,n){return e.apply(this,arguments)}}(),ey=function e(e,t){e.forEach(function(e){for(var n in e.assets){if(t.txHash==null)t.txHash=e.txHash;if(n!=="lovelace"&&t.bondId!==""&&n.lastIndexOf(t.bondId)>=0){var o=n.replaceAll(t.bondId,""),a=BigInt(e.assets[n]);if(eA.spo_bonds.poolOptimNftPolicy===o){t.bondWriterData.policy_id=o;t.bondWriterData.amount+=a;if(t.bondWriterData.utxo==null)t.bondWriterData.utxo=e}else if(eA.spo_bonds.poolBorrowNftPolicy===o){t.borrowerData.policy_id=o;t.borrowerData.amount+=a;if(t.borrowerData.utxo==null)t.borrowerData.utxo=e}else{t.poolOpenData.policy_id=o;t.poolOpenData.amount+=a;if(t.poolOpenData.utxo==null)t.poolOpenData.utxo=e}}}});return t},ew=function(){var e=a(function(e,t){var n,o;return h(this,function(a){switch(a.label){case 0:if(!(typeof t.poolClosedData!="undefined"&&typeof t.poolClosedData.utxo!="undefined"&&(typeof t.poolClosedData.utxo.datum!="undefined"||typeof t.poolClosedData.utxo.datumHash!="undefined")))return[3,2];return[4,e.optimClosedPoolDatumOf(t.poolClosedData.utxo)];case 1:n=a.sent();t["closedPoolDatum"]=n;a.label=2;case 2:if(!(typeof t.bondOpenData!="undefined"&&typeof t.bondOpenData.utxo!="undefined"&&(typeof t.bondOpenData.utxo.datum!="undefined"||typeof t.bondOpenData.utxo.datumHash!="undefined")))return[3,4];return[4,e.optimOpenDatumOf(t.bondOpenData.utxo)];case 3:o=es.apply(void 0,[a.sent()]);t["openBondDatum"]=o;a.label=4;case 4:return[2,t]}})});return function t(t,n){return e.apply(this,arguments)}}(),eg=function e(e,t){e.forEach(function(e){for(var n in e.assets){if(t.txHash==null)t.txHash=e.txHash;if(n!=="lovelace"&&t.bondId!==""&&n.lastIndexOf(t.bondId)>=0){var o=n.replaceAll(t.bondId,""),a=BigInt(e.assets[n]);if(eA.spo_bonds.poolOptimNftPolicy===o&&t.bondOpenData.utxo==null){t.bondOpenData.policy_id=o;t.bondOpenData.amount+=a;if(t.bondOpenData.utxo==null)t.bondOpenData.utxo=e}else{t.poolClosedData.policy_id=o;t.poolClosedData.amount+=a;if(t.poolClosedData.utxo==null)t.poolClosedData.utxo=e}}}});return t},ev=function e(){t.prop("disabled",true);n.prop("disabled",true);o.prop("disabled",true)},ex=function e(){t.prop("disabled",!eW);n.prop("disabled",!eN);o.prop("disabled",!eN||!en.is(":hidden"))},eD=function(){var t=a(function(){var t,n,o,a,r,i,l,u,c,d,f,p,b,m;return h(this,function(h){switch(h.label){case 0:t=e(this);h.label=1;case 1:h.trys.push([1,9,,10]);e(s).html("");el(t,true,"Get Escrow");n=e_(t,"Get Escrow","#asset-name","Please enter asset name");if(!(n!=undefined))return[3,8];localStorage.setItem(eO,n);o=j(),a=T();r=window.apps[a][o].contract_bond;return[4,r.utxosMintByUnit(eA.spo_bonds.poolOptimNftPolicy,n)];case 2:i=h.sent();if(i.length<=0)throw new Error("Not found token ".concat(n," on ").concat(a));return[4,r.utxoByUnit(eA.spo_bonds.poolOptimNftPolicy,n)];case 3:l=h.sent();u={txHash:null,bondId:n,borrowerData:{policy_id:"",amount:0n,utxo:null},bondWriterData:{policy_id:"",amount:0n,utxo:null},bondWriterDatum:{},poolOpenData:{policy_id:"",amount:0n,utxo:null},bondOpenData:{policy_id:"",amount:0n,utxo:null},poolClosedData:{policy_id:"",amount:0n,utxo:null}};return[4,eh(r,ey(i,u))];case 4:u=h.sent();if(!(typeof u!="undefined"&&u.bondWriterDatum.hasOwnProperty("bondSymbol")))return[3,7];return[4,r.utxosMintByUnit(u.bondWriterDatum.bondSymbol,n)];case 5:c=h.sent();if(!(c.length>0))return[3,7];return[4,ew(r,eg(c,u))];case 6:u=h.sent();h.label=7;case 7:if(typeof u!="undefined"){d=BigNumber(BigNumber(u.bondWriterDatum.epoRewards.lovelace)*73/BigNumber(u.bondWriterDatum.bondAmount)/1e6);f=BigNumber(u.bondWriterDatum.duration*u.bondWriterDatum.epoRewards.lovelace)/1e6;p=1-BigNumber(u.bondWriterDatum.otmFee)/1e4;b=typeof u.openBondDatum!="undefined"?u.openBondDatum.start+ep():null;G({issueBondTx:Q(u.txHash,eC),uniquenessNFT:Y("".concat(u.bondWriterData.policy_id,".").concat(u.bondId),eC),ownershipNFT:Y("".concat(u.borrowerData.policy_id,".").concat(u.bondId),eC),poolEquityToken:Y("".concat(u.poolOpenData.policy_id,".").concat(u.bondId),eC),duration:u.bondWriterDatum.duration,start:typeof u.openBondDatum!="undefined"?u.openBondDatum.start:null,buffer:u.bondWriterDatum.buffer,minPrepaid:u.openPoolDatum?u.openPoolDatum.minPrepaid:u.openBondDatum.duration,minBuffer:u.openPoolDatum?u.openPoolDatum.minBuffer:u.openBondDatum.buffer,bondToken:u.poolClosedData.policy_id!=""?Y("".concat(u.poolClosedData.policy_id,".").concat(u.bondId),eC):null,bondAmount:u.bondWriterDatum.bondAmount,epochRewardsLovelace:u.bondWriterDatum.epoRewards.lovelace,epochRewards:"".concat(BigNumber(u.bondWriterDatum.epoRewards.lovelace).toFormat(0)," lovelace"),borrowApr:"".concat(d.toFormat(2),"%"),borrowInterestValue:"".concat(BigNumber(f).toFormat(6)," ADA"),lendApr:"".concat(BigNumber(d*p).toFormat(2),"%"),lendInterestValue:"".concat(BigNumber(f*p).toFormat(6)," ADA"),epochStart:b!=null?b:null,epochEnd:b!=null?b+u.openBondDatum.duration:null,escrowLovelace:l.assets.lovelace,escrowValue:"".concat(BigNumber(l.assets.lovelace).toFormat(0)," lovelace")})}h.label=8;case 8:return[3,10];case 9:m=h.sent();ec(m,t);return[3,10];case 10:el(t,false,"Get Escrow");return[2]}})});return function e(){return t.apply(this,arguments)}}(),e_=function t(t,n,o,a,r){var i=e(o).val();if(typeof i=="undefined"||i==""||typeof r=="function"&&r(i)){e.alert({title:"Alert!",content:a,buttons:{ok:{btnClass:"btn-blue",action:function a(){e(o).focus();el(t,false,n)}}}});return undefined}return i},eO="BOND_NAME",ek=function(){var t=a(function(){var t,n,o,r,i,l,u,c,d,f;return h(this,function(p){switch(p.label){case 0:t=e(this);p.label=1;case 1:p.trys.push([1,10,,11]);e(s).html("");el(t,true,"Get Bond Listing");n=e_(t,"Get Bond Listing","#asset-name","Please enter asset name");if(!(n!=undefined))return[3,9];localStorage.setItem(eO,n);o=j(),r=T();i=window.apps[r][o].contract_bond;l={};if(!(!(typeof n=="undefined"||n=="")&&F().length>0))return[3,7];c=Promise.all;if(!(V()=="latest"))return[3,3];return[4,i.getListings(n)];case 2:d=p.sent();return[3,5];case 3:return[4,i.getListingsOfTradeAddress(n,V())];case 4:d=p.sent();p.label=5;case 5:return[4,c.apply(Promise,[d.map(function(){var e=a(function(e){var t,n,o,a,r,l,u;return h(this,function(s){switch(s.label){case 0:n=v(e.address);o=V()!="addr_test1wp4uszsq04mdt6e744g3aruedwlmkmgav7x4sad0g8msceqw32x43";if(!o)return[3,2];return[4,i.listingDatumOfDanogo(e)];case 1:r=s.sent();return[3,4];case 2:return[4,i.listingDatumOf(e)];case 3:r=s.sent();s.label=4;case 4:a=r;l=o?{paymentCredential:{PublicKeyCredential:[a.ownerPaymentKey]},stakeCredential:a.ownerStakeKey?{Inline:[{PublicKeyCredential:[a.ownerStakeKey]}]}:null}:a.owner;u=v(D(l,i.lucid));return[2,Object.assign(e,{utxoPaymentKey:n.paymentCredential.hash,utxoStakeKey:n.stakeCredential.hash,listingUtxoDatum:{ownerAddress:u.address.bech32,ownerPaymentKey:u.paymentCredential.hash,ownerStakeKey:(t=u.stakeCredential)===null||t===void 0?void 0:t.hash,requestedYield:BigNumber(a.requestedYield).toNumber()}})]}})});return function(t){return e.apply(this,arguments)}}())])];case 6:u=p.sent();return[3,8];case 7:u=null;p.label=8;case 8:G.apply(void 0,[(l.bond_listing=u,l)]);p.label=9;case 9:return[3,11];case 10:f=p.sent();ec(f,t);return[3,11];case 11:el(t,false,"Get Bond Listing");return[2]}})});return function e(){return t.apply(this,arguments)}}(),eB=function(){var t=a(function(){var t,n,o,a,r,i;return h(this,function(l){switch(l.label){case 0:t=e(this);l.label=1;case 1:l.trys.push([1,3,,4]);e(s).html("");el(t,true,"Show Bond in My Wallet");n=j(),o=T();a=window.apps[o][n].contract_bond;r={};return[4,a.getMyBondInWallet()];case 2:G.apply(void 0,[(r.my_bonds=l.sent(),r)]);el(t,false,"Show Bond in My Wallet");return[3,4];case 3:i=l.sent();ec(i,t);return[3,4];case 4:return[2]}})});return function e(){return t.apply(this,arguments)}}(),eI=function e(e){var t=e_(e,"Listing","#asset-name","Please enter asset name");var n=t!=undefined?e_(e,"Listing","#qty-listing","Quantity is required and must be greater than zero",function(e){return e<1}):undefined;var o=n!=undefined?e_(e,"Listing","#yield-listing","Requested Yield is required and in range 1-9999",function(e){return e<1||e>9999}):undefined;return{input_valid:o!=undefined,asset_name:t,qty_listing:n,yield_listing:o}},eP=function t(t,n,o){var a=e_(t,n,"#asset-name","Please enter asset name");var r=a!=undefined?e_(t,n,"#tx-hash","Tx hash is required"):undefined;var i=r!=undefined?e_(t,n,"#output-index","Output Index is required and must be not less than zero",function(e){return e<0}):undefined;var l=i!=undefined?e_(t,n,"#qty-action","Quantity is required and must be not less than zero",function(e){return e<0}):undefined;var u=e("#yield-update").val();var s=typeof u!="undefined"&&u!=""&&o!="buy"?e_(t,n,"#yield-update","Requested Yield is required and in range 1-9999",function(e){return e<1||e>9999}):undefined;return{input_valid:l!=undefined||s!=undefined,asset_name:a,tx_hash:r,output_index:i,qty_action:l,yield_update:s}},eS=function t(t,n){if(eN){e("#act-get-my-bond").off("click");e("#act-get-my-bond").on("click",eB);e("#act-listing-bond").off("click");e("#act-listing-bond").on("click",function(){e(s).html("");var t=e(this);el(t,true,"Listing");var o=eI(t);if(o.input_valid){localStorage.setItem(eO,o.asset_name);n.list(o.asset_name,o.qty_listing,o.yield_listing).then($).catch(J).then(function(){el(t,false,"Listing")})}});e("#act-update-listing-bond").off("click");e("#act-update-listing-bond").on("click",function(){e(s).html("");var t=e(this);el(t,true,"Update Listing");var o=eP(t,"Update Listing","update");if(o.input_valid){var a={txHash:o.tx_hash,outputIndex:parseInt(o.output_index)};n.getListingOrBid(a).then(function(e){if(e!=null){if(o.qty_action<=0){n.cancelListing(e).then($).catch(J).then(function(){el(t,false,"Update Listing")})}else{localStorage.setItem(eO,o.asset_name);n.changeListing(e,o.asset_name,o.qty_action,o.yield_update).then($).catch(J).then(function(){el(t,false,"Update Listing")})}}else{throw new Error("Not found listed Utxo with outRef={txHash:".concat(a.txHash,", outputIndex:").concat(a.outputIndex,"}"))}}).catch(function(e){J(e);el(t,false,"Update Listing")})}});e("#act-buy-listing-bond").off("click");e("#act-buy-listing-bond").on("click",function(){e(s).html("");var t=e(this);el(t,true,"Buy Listing");var o=eP(t,"Buy Listing","buy");if(o.input_valid){var a={txHash:o.tx_hash,outputIndex:parseInt(o.output_index)};n.getListingOrBid(a).then(function(e){if(e!=null){if(o.qty_action<=0){throw new Error("Buy qty must be greater than zero and less equal than quantity of listing Utxo")}else{n.buy([{utxo:e,qty:o.qty_action}]).then($).catch(J).then(function(){el(t,false,"Buy Listing")})}}else{throw new Error("Not found listed Utxo with outRef={txHash:".concat(a.txHash,", outputIndex:").concat(a.outputIndex,"}"))}}).catch(function(e){J(e);el(t,false,"Buy Listing")})}})}},eE=function(){var t=a(function(){var t,n;return h(this,function(o){switch(o.label){case 0:q();K();C();return[4,W()];case 1:o.sent();ee.on("click",et);en.on("click",ea);er(true);t=localStorage.getItem(eO);if(typeof t!="undefined"&&t!=""&&t!="null"){e("#asset-name").val(t)}n=localStorage.getItem(m);if(typeof n!="undefined"&&n!=""&&n!="null"){en.trigger("click")}return[2]}})});return function e(){return t.apply(this,arguments)}}();var eC="cardanoscan",eW=false,eN=false,eA=undefined;eE()})(jQuery);